<link rel="import" href="../../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../behaviors/base-behavior.html">
<link rel="import" href="h2-widget-base.html">
<dom-module id="h2-select-list">
    <template>
        <paper-dropdown-menu id="dropdownMenu"
                             always-float-label
                             required="{{field.required}}"
                             error-message="{{field.prompt}}"
                             label="{{field.label}}"
                             style="float:left;margin: 12px;">
            <paper-listbox slot="dropdown-content" selected="0">
                <template is="dom-repeat"
                          items="{{ getValueByKey(model, field.itemsField, '[]') }}"
                          as="selectItem">
                    <paper-item>
                        [[ getValueByKey(selectItem, field.displayField) ]]
                    </paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
    </template>
    <script>
      class H2SelectList extends Polymer.mixinBehaviors([BaseBehavior], H2WidgetBase) {
        static get is() {
          return "h2-select-list";
        }

        validate() {
          return this.$.dropdownMenu.validate();
        }

        reset() {
          this.$.dropdownMenu.querySelector('paper-listbox').selected = -1;
        }

        getValue() {
          const value = this.$.dropdownMenu.value;
          const items = this.model[this.field.itemsField] || [];
          const displayField = this.field.displayField;
          for (let item of items) {
            if (item[displayField] === value) {
              return item[this.field.valueField];
            }
          }
        }
      }
      customElements.define(H2SelectList.is, H2SelectList);
    </script>
</dom-module>