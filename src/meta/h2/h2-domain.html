<link rel="import" href="h2-domain-query.html">
<link rel="import" href="h2-grid.html">
<dom-module id="h2-domain">
    <template>
        <h2-domain-query form-meta="{{metadata.query}}" result="{{result}}"></h2-domain-query>
        <h2-grid metadata="{{metadata.result}}" models="[[result]]"></h2-grid>
    </template>
    <script>
      class H2Domain extends Polymer.Element {
        constructor() {
          super();
        }

        static get is() {
          return "h2-domain";
        }

        static get properties() {
          return {
            result: {
              type: Array
            },
            metadata: {
              type: Object,
            },
            url: {
              type: String,
            }
          }
        }

        init() {
          this.metadata = {
            query: {
              formUrl: "/order/list.do",       // 表单提交的url
              httpMethod: "GET",
              fields: [
                {
                  datatype: "text",
                  name: "orderNo",
                  label: "订单号",
                },
                {
                  datatype: "select",
                  name: "product",
                  label: "产品",
                  displayField: "productName",
                  valueField: "productId",
                  itemsField: "products",
                  prompt: "请选产品"
                },
                {
                  datatype: "radio",
                  name: "deliveryType",
                  label: "配送方式",
                  displayField: "name",
                  valueField: "id",
                  itemsField: "deliveryTypes",
                }
              ],
            },
            result: {
              grids: [
                {
                  datatype: "text",
                  name: "orderNo",
                  label: "订单号",
                  required: true,
                  mutil: false,
                },
                {
                  datatype: "text",
                  name: "createAt",
                  label: "创建时间",
                  required: true,
                  mutil: false,
                  format: 'yyyy-MM-dd'
                },
                {
                  datatype: "action",
                  name: "actions",
                  label: "操作",
                }
              ],
              actions: {
                "order-cancel": {
                  actionId: "order-cancel",
                  actionName: "取消",
                  operType: 1,
                  formMeta: {
                    formUrl: "/order/cancelOrder.do",
                    httpMethod: "GET",
                    confirm:"确认取消订单？",
                    fields: [
                      {
                        datatype: "text",
                        name: "orderId",
                        label: "订单Id",
                        required: true,
                        mutil: false,
                      },
                    ],
                  }
                },
                "new-order-item": {
                  actionId: "new-order-item",
                  actionName: "新子单",
                  operType: 2,
                  formMeta: {
                    formUrl: "/order/saveOrderItem.do",       // 表单提交的url
                    httpMethod: "POST",
                    title: "创建新子单",
                    fields: [
                      {
                        datatype: "text",
                        name: "orderId",
                        label: "订单Id",
                        required: true,
                        editable: false,
                        mutil: false,
                      },
                      {
                        datatype: "select",
                        name: "product",
                        label: "产品",
                        required: true,
                        editable: true,
                        mutil: false,
                        displayField: "productName",
                        valueField: "productId",
                        itemsField: "products",
                        prompt: "请选产品"
                      },
                      {
                        datatype: "textarea",
                        name: "remark",
                        label: "备注",
                        editable: true,
                        required: false,
                        mutil: false,
                        validate: true,
                        "max-length": 100
                      },
                      {
                        datatype: "radio",
                        name: "deliveryType",
                        label: "配送方式",
                        required: true,
                        editable: true,
                        mutil: false,
                        displayField: "name",
                        valueField: "id",
                        itemsField: "deliveryTypes",
                        prompt: "请选产品"
                      }
                    ],
                  }
                }
              }
            }
          };

        }

        ready() {
          super.ready();
          setTimeout(() => {
            this.init();
          }, 100);

        }
      }
      customElements.define(H2Domain.is, H2Domain);
    </script>
</dom-module>