<link rel="import" href="../behaviors/base-behavior.html">
<link rel="import" href="h2-action.html">
<link rel="import" href="h2-crust.html">
<dom-module id="h2-grid">
    <template>
        <style>
            dom-repeat {
                display: none;
            }
            :host {
                @apply --h2-grid-theme;
            }
        </style>
        <slot name="filter"></slot>
        <table border="1" width="100%">
            <thead>
            <tr>
                <template is="dom-repeat" items="[[ metadata.grids ]]">
                    <th>[[item.label]]</th>
                </template>
            </tr>
            </thead>
            <tbody>
            <template is="dom-repeat" items="[[models]]" as="model">
                <tr>
                    <template is="dom-repeat" items="[[metadata.grids]]" as="field">
                        <td>
                            <template is="dom-if" if="{{ isOneOf(field.datatype,'text','number','date') }}">
                                <h2-crust element="[[ render(model,field) ]]"></h2-crust>
                            </template>

                            <template is="dom-if" if="{{ isEqual(field.datatype,'action') }}">
                                <template is="dom-repeat" items="[[ model.actions ]]" as="actionId">
                                    <span>
                                        <h2-action action="{{ getValueByKey(metadata.actions, actionId ) }}" model="[[model]]">
                                            <h2-form slot="form"
                                                     id="form"
                                                     model="[[ model ]]"
                                                     form-meta="[[ getMeta(metadata.actions, actionId ) ]]"></h2-form>
                                        </h2-action>
                                    </span>
                                </template>
                            </template>
                        </td>
                    </template>
                </tr>
            </template>
            </tbody>
        </table>
    </template>
    <script>
      class H2Grid extends Polymer.mixinBehaviors([BaseBehavior], Polymer.Element) {
        constructor() {
          super();
        }

        static get is() {
          return "h2-grid";
        }

        getMeta(actions,actionId){
          return this.getValueByKey(actions, actionId).formMeta;
        }

        static get properties() {
          return {
            models: {
              type: Array,
              observable: true
            },
            metadata: {
              type: Object,
              observable: true
            }
          }
        }
      }
      customElements.define(H2Grid.is, H2Grid);
    </script>
</dom-module>