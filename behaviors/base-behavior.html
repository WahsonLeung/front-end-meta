<script>
  BaseBehavior = {
    /**
     * 判断第一个参数是否与后面的某个参数相等， 使用Object.is() 进行判断
     * @param args
     * @returns {boolean}
     */
    isOneOf(...args) {
      if (Array.isArray(args) && args.length > 0) {
        const target = args[0];
        return args.slice(1).filter(arg => Object.is(arg, target)).length > 0;
      }

      return false;
    },

    isEqual(left, right) {
      return Object.is(left, right);
    },


    isFunction(fn) {
      return fn && Function.prototype.isPrototypeOf(fn);
    },

    /**
     *
     * @param model
     * @param key
     * @param defVal  支持任何符合json格式的字符串
     * @returns {*}
     */
    getValueByKey(model, key, defVal = JSON.stringify("")) {
      return (model && (key in model)) ? model[key] : JSON.parse(defVal);
    },


    /**
     * 通过路径获取对象字段值
     * @param model 如： { foo: { bar: 1} }
     * @param path  如 "foo.bar"
     * @param defVal  支持任何符合json格式的字符串
     * @returns {*}
     */
    getValueByPath(model, path, defVal) {
      // TODO if user wants a defVal equal to '', this won't work.
      if (!model) return !!defVal ? JSON.parse(defVal) : undefined;

      const splits = path.split('.');
      let copy = model;
      for (let key of splits) {
        if (!copy[key]) return !!defVal ? JSON.parse(defVal) : undefined;
        copy = copy[key];
      }

      return copy;
    },

    /**
     *
     * @param model
     * @param field
     * @returns {*}
     */
    elementRender(model, field) {
      const _render = field && field.render;
      if (Function.prototype.isPrototypeOf(_render)) {
        return _render(model);
      }
      return this.getValueByKey(model, field.name);
    },


    suite(obj) {
      this.__suite(obj);
      return obj;
    },

    __suite(target, parent) {
      if (!Object.prototype.isPrototypeOf(target))
        throw new TypeError(`target is not an object`);

      Object.defineProperties(target, {
        select: {
          writable: false,
          enumerable: false,
          value: (path) => {
            if (!target[path]) throw new TypeError(`${path} is not a property of target`);
            if (Object.prototype.isPrototypeOf(target[path]) && !target[path].hasOwnProperty('select')) {
              this.__suite(target[path], target);
            }
            return target[path];
          }
        },
        unselect: {
          writable: false,
          enumerable: false,
          value: function () {
            return parent || target;
          }
        },
        ext: {
          writable: false,
          enumerable: false,
          value: function (key, value) {
            target[key] = value;
            return target;
          }
        },
        batchExt: {
          writable: false,
          enumerable: false,
          value: function (key, handler) {
            target[key].forEach(handler);
            return target;
          }
        }

      });
    }

  }
</script>